# Generated by Chef
set daemon <%= @poll_freq %>
  with start delay <%= @start_delay %>

set logfile <%= @log_file %>

set idfile <%= @id_file %>

set statefile <%= @state_file %>

<% @mail_servers.each do |mailserver| %>
set mailserver
  <%= mailserver.hostname %>
  <% if mailserver.key?('port') && mailserver.port %>
  port <%= mailserver.port %>
  <% end %>
  <% if mailserver.key?('username') && mailserver.username %>
  username '<%= mailserver.username %>'
  <% end %>
  <% if mailserver.key?('password') && mailserver.password %>
  password '<%= mailserver.password %>'
  <% end %>
  <% if mailserver.key?('security') && mailserver.security %>
  using <%= mailserver.security.upcase %>
  <% end %>
  <% if mailserver.key?('timeout') && mailserver.timeout %>
  with timeout <%= mailserver.timeout %>
  <% end %>

<% end %>
set mail-format {
      from: <%= @mail_from %>
   subject: <%= @mail_subject %>
   message: <%= @mail_msg %>
}

<% @subscribers.each do |subscriber| %>
set alert <%= subscriber.name %>
  only on { <%= subscriber.subscriptions.join(', ') %>}

<% end %>
set eventqueue
  basedir <%= @eventqueue_dir %>
  slots <%= @eventqueue_slots %>

set httpd port <%= @port %> and
  use address <%= @listen %>
  <% @allow.each do |allowed| %>
  allow <%= allowed %>
  <% end %>

<% if @mmonit_url %>
set mmonit <%= @mmonit_url %>

<% end %>
include <%= @conf_dir %>/*
